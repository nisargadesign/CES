AddDefaultCharset UTF-8

#GZIP
AddOutputFilterByType DEFLATE text/plain
AddOutputFilterByType DEFLATE text/html
AddOutputFilterByType DEFLATE text/xml
AddOutputFilterByType DEFLATE text/css
AddOutputFilterByType DEFLATE application/xml
AddOutputFilterByType DEFLATE application/xhtml+xml
AddOutputFilterByType DEFLATE application/rss+xml
AddOutputFilterByType DEFLATE application/javascript
AddOutputFilterByType DEFLATE application/x-javascript

#Browser caching
<IfModule mod_expires.c>
ExpiresActive On
ExpiresByType image/jpg "access 1 year"
ExpiresByType image/jpeg "access 1 year"
ExpiresByType image/gif "access 1 year"
ExpiresByType image/png "access 1 year"
ExpiresByType text/css "access 1 month"
ExpiresByType application/pdf "access 1 month"
ExpiresByType text/x-javascript "access 1 month"
ExpiresByType application/x-shockwave-flash "access 1 month"
ExpiresByType image/x-icon "access 1 year"
ExpiresDefault "access 8 days"
</IfModule>

#keep alive
<ifModule mod_headers.c>
Header set Connection keep-alive
</ifModule>

Options +FollowSymLinks
RewriteEngine on

#Route HTTPS for m. subdomain to /m/ directory
RewriteCond %{SERVER_PORT} ^443$
RewriteCond %{HTTP_HOST} ^m\.cuttingedgestencils\.com$ [NC]
RewriteCond %{REQUEST_URI} !^/m/
RewriteRule ^(.*) /m/$1

ErrorDocument 404 /friendly_url.php

# Rewrite all requests for images from WWW
RewriteCond %{HTTP_HOST} ^m\.cuttingedgestencils\.com
RewriteCond %{REQUEST_URI} ^/images
RewriteRule ^(.*)$ "http\:\/\/www\.cuttingedgestencils\.com\/%{REQUEST_URI}" [R=301,L]

#remove index.php from URLs; needed for disqus and social media counts of "likes"
RewriteCond %{THE_REQUEST} ^[A-Z]{3,9}\ /([^/]+/)*index\.php\ HTTP/
RewriteRule ^(([^/]+/)*)index\.php$ http://www.cuttingedgestencils.com/$1 [R=301,L]

#redirect to www; needed for SEO, disqus and social media counts of "likes"
RewriteCond %{HTTP_HOST} ^cuttingedgestencils.com$ [OR]
RewriteCond %{HTTP_HOST} ^216.70.85.26$ 
RewriteRule ^(.*)$ "http\:\/\/www\.cuttingedgestencils\.com\/$1" [R=301,L]

#affiliate links redirection so that they would be recorded in Google Analytics
RewriteRule ^(HG|HGTV|HDTV|DIY)$ http://%{HTTP_HOST}/?referrer=$1 [NC,R=302]

#if no extention add .html; needed for disqus and social media counts of "likes"
RewriteCond {REQUEST_URI} !=.*\.html
RewriteRule ^([^.]+[^/])$ http://%{HTTP_HOST}/$1.html? [NC,R=301,L]

#if not a php file HTM -> HTML; needed for disqus and social media counts of "likes"
RewriteCond {REQUEST_URI} !=.*\.php
RewriteRule ^(.*)\.htm$ http://%{HTTP_HOST}/$1.html? [NC,R=301,L]

#if .HTML with category_id parameter - remove it; needed for disqus and social media counts of "likes"
RewriteCond %{QUERY_STRING} ^category_id=[0-9]*&*(tab=[a-z]*)*$
RewriteRule ^(.*\.htm[l]*)$ http://%{HTTP_HOST}/$1?%1 [NE,R=301,L]

#if .HTML with tab parameter - redirect to correct anchor (?tab=spec -> #spec); needed for disqus and social media counts of "likes"
RewriteCond %{QUERY_STRING} ^tab=([a-z]*)$
RewriteRule ^(.*\.htm[l]*)$ http://%{HTTP_HOST}/$1#%1? [NE,R=301,L]

#if .html and https redirect to http; needed for disqus and social media counts of "likes"
RewriteCond %{REQUEST_URI} .*\.html.* [OR]
RewriteCond %{REQUEST_URI} "^/$"
RewriteCond %{HTTPS} on
RewriteRule ^(.*)$ http://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

Redirect 301 /wall-mural-stencil-faq-2.html http://www.cuttingedgestencils.com/wall-mural-stencil-faq.html
Redirect 301 /wall-stencils-damask-stencils.html http://www.cuttingedgestencils.com/wall-stencils-geometric-stencils.html
Redirect 301 /stencils-for-walls.html http://blog.cuttingedgestencils.com/

#old rewrites changed into redirects
Redirect 301 /flower-stencils-alliums-wall-stencils.html http://www.cuttingedgestencils.com/large-flower-stencil.html
Redirect 301 /stencil-wall-decal-tree-branch-stencils.html http://www.cuttingedgestencils.com/wall-art-stencil-decal.html
Redirect 301 /flower-stencils-large-wall-stencils.html http://www.cuttingedgestencils.com/flower-stencil-wall-stencils.html
Redirect 301 /stenciling-ideas.html http://www.cuttingedgestencils.com/stenciling-instructions.html
#Redirect 301 /nursery-stencils.html http://www.cuttingedgestencils.com/nursery-stencils-walls.html
